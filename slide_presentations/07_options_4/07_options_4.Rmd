---
title: "Options Part 4"
author: "Pritam Dalal"
output: 
  beamer_presentation:
    theme: "default"
    colortheme: "fly"
    fonttheme: "default"
header-includes:
   - \usepackage{amsmath}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Calculating PNL (Part 1 of)

- Suppose you trade an option $\mathcal{O}$ at a price $P$ on trade-date $T_{1}$.

- Suppose you hold the option until expiration, which is trade-date $T_{n}$.

- The letter $i$ will sever as an index over the trade-dates, so $i = 1,\ldots,n$. 


## Calculating PNL (Part 2 of)
- Let $B_{i}$ and $A_{i}$ be the end-of-day bid/ask prices of the option for trade-date $T_{i}$.  

- Note that $B_{n} = A_{n} = \text{option-payoff}$.

- $D_{i}$ - daily pnl for the trade as of end-of-day $T_{i}$.

- $C_{i}$ - trade-to-date (cummulative) pnl for the trade as of end-of-day $T_{i}$.



## Calculating PNL (Part 3 of)

*Cummulative as Sum of Daily:* **BUY**


\begin{align*}
D_{i} &= \begin{cases} B_{i} - P & i = 1 \\ B_{i} - B_{i-1} & i > 1 \end{cases} \\[10pt]
C_{i} &= \sum_{k=1}^{i} D_{k}
\end{align*}

&nbsp;

**Exercise:** Show that $C_{j} = B_{j} - P$. 


## Calculating PNL (Part 4 of)
 
*Cummulative as Sum of Daily:*  **SELL**


\begin{align*}
D_{i} &= \begin{cases} P - A_{i} & i = 1 \\ A_{i-1} - A_{i} & i > 1 \end{cases} \\[10pt]
C_{i} &= \sum_{k=1}^{i} D_{k}
\end{align*}

&nbsp;

**Exercise:** Show that $C_{i} = P - A_{i}$. 



## Calculating PNL (Part 5 of)

*Daily as Change in Cummulative:* **BUY**


\begin{align*}
C_{i} &= B_{i} - P \\[10pt]
D_{i} &= \begin{cases} C_{i} & i = 1 \\ C_{i} - C_{i-1} & i > 1 \end{cases}
\end{align*}

&nbsp;

**Exercise:** Show that both formulations of $D_{i}$ are equivalent.


## Calculating PNL (Part 6 of)

*Daily as Change in Cummulative:* **SELL**


\begin{align*}
C_{i} &= P - A_{i} \\[10pt]
D_{i} &= \begin{cases} C_{i} & i = 1 \\ C_{i} - C_{i-1} & i > 1 \end{cases}
\end{align*}

&nbsp;

**Exercise:** Show that both formulations of $D_{i}$ are equivalent.



## Calculating PNL (Part 7 of)

SHOW A SIMPLE data analysis example here.




## Black-Scholes-Merton Formula (1 of)
\vspace{-25pt}
\begin{align*}
m = \text{BSM}(\text{p/c}, K, \text{T}, S_{t},\sigma, \delta, r)
\end{align*}

**Contract Features**

- p/c - put or call

- $K$ - strike price

- T - expiration date (time to expiration)

**Market Values**

- $S_{t}$ - current underlying price

- $\sigma$ - estimate of the standard deviation log-return of the price of underlying between now and expiration

- $\delta$ - estimate of dividends paid over the life of the option

- $r$ - risk-free interest rate


## Black-Scholes-Merton Formula (2 of )

```{r}
library(tidyverse)
library(fOptions)
upx <- seq(50, 150, 5)
type = "c"
K = 100
time_to_exp = 0.75
tenors = seq(0, 0.75, 0.125)
vol <- 0.15
payoff <- max((upx - K),0)
div = 0
rf = 0.01

opt <-
fOptions::GBSOption(TypeFlag = type
                    ,S = upx
                    ,X = K
                    ,Time = time_to_exp
                    ,r = rf
                    ,b = div
                    ,sigma = vol)

df_graph_data <- tibble(
  payoff = payoff
  , price = opt@price
  , underlying = upx
)

ggplot(dtat)
```



